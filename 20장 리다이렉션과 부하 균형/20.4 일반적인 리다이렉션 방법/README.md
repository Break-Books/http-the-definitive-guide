# 일반적인 리다이렉션 방법

## HTTP Redirection

## DNS Redirection

한 도메인에 여러 IP 주소를 연결할 수 있고, 여러 IP 주소를 반환하도록 설정될 수 있습니다.

간단한 라운드 로빈 방식부터, 로드 밸런싱까지 종류가 다양합니다.

### DNS round robin

가장 단순한 라운드 로빈. 가장 흔한 리디렉션 기술 중 하나. 순수한 부하 균형 전략.

nslookup으로 CNN.com을 접속했을 때의 결과...

### Multiple addresses and round-robin address rotation

조회가 이루어질 때마다 주소들을 회전시킵니다. 이러한 주소 회전을 DNS 라운드 로빈이라고 합니다.

### DNS round robin for load balancing

### The impact of DNS caching

DNS 주소 회전은 서버 주소의 다른 순서로 인해 부하를 분산시키지만, 완벽하지 않습니다. 응용 프로그램, 운영체제, 일부 기본 DNS 서버에서 캐싱해서 재사용하기 때문입니다. 브라우저도 캐싱합니다.

### Other DNS-based redirection algorithms

- 부하 균형 알고리즘: 웹 서버의 부하를 추적하고 가장 부하가 적은 웹 서버를 목록의 맨 앞에 배치합니다.
- 근접 라우팅 알고리즘: 지리적으로 분산된 웹 서버에서 가장 가까운 웹 서버로 유도합니다.
- 고장 마스킹 알고리즘: 네트워크 상태를 모니터링하고 서비스 중단이나 오류난 서버를 제외하고 라우팅합니다.

보통, 콘텐츠 제공자의 제어 하에 있는 서버가 이런 고급 서버 추적 알고리즘을 사용합니다.

근접 서버를 찾는 서비스의 단점 중 하나는 사용자 아이피 기반이 아니라, 로컬 DNS 아이피 기반이라는 점입니다.

## Anycast Addressing

여러 지리적으로 분산된 웹 서버가 동일한 IP 주소를 가지며, 최단 경로 라우팅 기능에 의존하여 클라이언트 요청을 가장 가까운 서버로 보냅니다.

실험적 기술로 서버가 라우터 통신 프로토콜을 사용해야 하고 주소 충돌을 처리할 수 있어야 합니다.

## IP MAC Forwarding

각 패킷에는 소스와 목적지 주소의 IP와 포트 번호 4개가 있으며, 이 레이어 4를 인식하는 장치들이 이 주소를 관찰합니다.

각 패킷에는 레이어 2 (스위치, 허브) 장치가 신경 쓰는 MAC주소가 있습니다. MAC주소의 패킷을 나가는 MAC 주소로 전달하는 데에 역할이 있습니다.

스위치가 MAC 간 트래픽을 보내는 역할을 담당합니다. 스위치는 레이어 4를 인식하고, 해당 정보를 기반으로 라우팅 결정을 내립니다.

예를 들어, 레이어 4 스위치는 포트 80으로 지정된 모든 웹 트래픽을 프록시로 보낼 수 있습니다.

만약 HTTP 콘텐츠가 캐시에 있고 여전히 신선하다면, 프록시 캐시가 이를 제공합니다. 그렇지 않으면 클라이언트를 대신해서 원본 서버로 HTTP요청을 보냅니다.

## IP Address Forwarding

레이어 4 정보 (주소, 패킷)을 검사하고, 목적지 MAC 주소 대신 아예 목적지 IP 주소를 변경하여 패킷을 라우팅 할 수도 있습니다.

MAC 포워딩은 오직 한 홉 떨어져있는 근접 이웃으로만 포워딩 할 수 있지만, 아이피 주소 포워딩은 그럴 필요가 없습니다.

이러한 유형의 포워딩을 NAT이라고 하기도 합니다. 네트워크 주소 변환

### 라우팅 대칭 문제

TCP를 수락하는 스위치는 해당 연결을 관리하고, 응답도 스위치로 다시 돌아와야 합니다. 응답의 반환 경로를 제어하는 두 가지 방법이 있습니다.

1. 패킷의 소스 IP 주소를 스위치 주소로 변경하기.
이러면 스위치와 서버 네트워크 구성에 관계 없이 응답 패킷이 스위치로 옵니다.

이것을 풀 NAT이라고 합니다.

이때 IP 포워딩 장치는 목적지와 소스 IP 주소 모두를 변환합니다. 이 경우 클라이언트의 IP 주소를 알 수 없게 되는 단점이 있고, 인증이나 결제 목적으로 클라이언트의 주소를 알아야 되는 경우 문제가 될 수 있습니다.

2. 소스 IP 주소가 클라이언트의 주소로 유지되는 경우, 서버와 클라이언트 사이에 스위치를 거치지 않고 직접 가는 경로가 하드웨어적으로 존재하지 않도록 해야 합니다. 이를 half NAT라고 합니다. 제어가 필요한 단점이 있습니다.
