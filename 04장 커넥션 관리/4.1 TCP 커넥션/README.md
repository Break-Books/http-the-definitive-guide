# 4.1 TCP 커넥션

현재 전 세계 대부분의 HTTP 통신은 TCP/IP 프로토콜을 통해 이루어지고 있다.
세계 어디에서든 클라이언트와 서버는 TCP/IP 커넥션을 맺을 수 있으며, 일단 커넥션이 맺어지면 클라이언트와 서버간에 주고받는 메시지는 안전하게 전달된다.

- HTTP 요청에 따른 TCP 커넥션 동작
![](https://velog.velcdn.com/images/hellojihyoung/post/03a3b982-224f-44af-99df-645cdecb2245/image.png)

<br>

## 4.1.1 신뢰할 수 있는 데이터 전송 통로인 TCP
TCP 커넥션은 인터넷을 안정적으로 연결해주며, TCP 커넥션 한쪽에 있는 바이트들은 반대쪽으로 순서에 맞게 정확히 전달된다.

<br>

## 4.1.2 TCP 스트림은 세그먼트로 나뉘어 IP 패킷을 통해 전송된다
TCP는 `IP 패킷`(혹은 IP 데이터그램)이라고 불리는 작은 조각을 통해 데이터를 전송한다.
- HTTP + SSL or TLS = HTTPS
  - HTTP에 보안 기능을 더한 HTTPS가 존재
    ![](https://velog.velcdn.com/images/hellojihyoung/post/f87ccd75-c86c-4747-a701-8457709412ed/image.png)


<br>

**HTTP 메세지 전송 과정은 아래와 같다.**
1. 현재 연결되어있는 커넥션을 통해서 메시지를 순서대로 보낸다.
2. TCP는 세그먼트라는 단위로 데이터 스트림을 잘게 나눈다.
3. 세그먼트를 IP 패킷이라고 불리는 봉투에 담아서 인터넷을 통해 데이터를 전달한다.
    - 각 세그먼트는 하나의 IP 주소에서 다른 IP 주소로 IP 패킷에 담겨 전달된다.
  
![](https://velog.velcdn.com/images/hellojihyoung/post/d28928d5-4930-4a46-ab64-657170b30065/image.png)


<br>

## 4.1.3 TCP 커넥션 유지하기
TCP는 포트 번호를 통해 여러개의 커넥션을 유지하며, TCP 커넥션은 네 가지 값으로 식별한다.

- 발신지 IP 주소
- 발신지 포트
- 수신지 IP 주소
- 수신지 포트
  
이 네 가지 값으로 유일한 커넥션을 생성한다.

<br>

## 4.1.4 TCP 소켓 프로그래밍
운영체제에서 제공하는 TCP 소켓 API 들은 HTTP 프로그래머에게 TCP 와 IP 의 세부사항을 알지 못해도 TCP 커넥션을 이용할 수 있게 해준다.

> **소켓(Socket)이란?** <br>
프로그램이 네트워크에서 데이터를 송수신할 수 있도록 "네트워크 환경에 연결할 수 있게 만들어진 연결부"
두 프로그램이 네트워크를 통해 서로 통신을 수행할 수 있도록 양쪽에 생성되는 링크의 단자이다.
두 소켓이 연결되면 서로 다른 프로세스끼리 데이터를 전달할 수 있다.
상대방에게 데이터를 보내거나 받는 역할을 한다.

<br>

### 소켓 통신 과정
![](https://velog.velcdn.com/images/hellojihyoung/post/2a83e8a4-242e-47ff-9786-cc158b5f88ce/image.png)


